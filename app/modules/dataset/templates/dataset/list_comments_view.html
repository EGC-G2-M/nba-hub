{% extends "base_template.html" %}

{% block title %}Comments{% endblock %}

{% block content %}

<div class="container-fluid py-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h4 fw-bold mb-0">
            Comments <span class="text-muted fs-6 fw-normal">({{ comments|length }})</span>
        </h1>
        <button type="button" class="btn btn-primary btn-sm d-flex align-items-center gap-2" data-bs-toggle="modal"
            data-bs-target="#createCommentModal">
            <i data-feather="plus-circle" style="width: 18px; height: 18px;"></i>
            New comment
        </button>
    </div>

    <div class="row">
        <div class="col-12 col-lg-10">

            {% if comments %}
            {% for comment in comments %}
            <div class="alert alert-warning">
                <strong>DEBUG:</strong><br>
                Comment ID: {{ comment.id }}<br>
                User ID (numero): {{ comment.user_id }}<br>
                Objeto User: {{ comment.user }}<br>
                Objeto Profile: {{ comment.user.profile }}
            </div>

            {% set user_name = "Usuario Anónimo" %}
            {% set user_avatar_seed = comment.user_id %}

            {% set user_name = "Anónimo" %}

            {% if comment.user and comment.user.profile %}
            {% set user_name = comment.user.profile.name ~ " " ~ comment.user.profile.surname %}

            {% else %}
            {% set user_name = "User " ~ comment.user_id %}
            {% endif %}

            {% set user_avatar_seed = user_name %}

            <div class="d-flex align-items-start mb-4">

                <div class="flex-shrink-0">
                    <img src="https://ui-avatars.com/api/?name={{ user_avatar_seed }}&background=random&size=128"
                        class="rounded-circle" alt="Avatar" width="40" height="40">
                </div>

                <div class="ms-3 w-100">
                    <div class="d-flex align-items-baseline mb-1">
                        <h6 class="fw-bold mb-0 me-2" style="font-size: 0.95rem;">
                            {{ user_name }}
                        </h6>
                        <small class="text-muted" style="font-size: 0.75rem;">
                            {{ comment.created_at }}
                        </small>
                    </div>

                    <p class="mb-2 text-break" style="font-size: 0.95rem; line-height: 1.4;">
                        {{ comment.content }}
                    </p>

                    <div class="d-flex align-items-center gap-3">
                        <a href="#" class="text-decoration-none text-secondary d-flex align-items-center gap-1">
                            <i data-feather="thumbs-up" style="width: 16px; height: 16px;"></i>
                        </a>
                        <a href="#" class="text-decoration-none text-secondary">
                            <i data-feather="thumbs-down" style="width: 16px; height: 16px;"></i>
                        </a>
                        <a href="#" class="text-decoration-none text-secondary fw-bold" style="font-size: 0.8rem;">
                            Responder
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}

            {% else %}
            <div class="text-center py-5 bg-light rounded-3">
                <div class="mb-3">
                    <i data-feather="message-circle" class="text-muted" style="width: 48px; height: 48px;"></i>
                </div>
                <h5 class="text-muted fw-bold">No comments yet</h5>
                <button type="button" class="btn btn-outline-primary mt-2" data-bs-toggle="modal"
                    data-bs-target="#createCommentModal">
                    Write a comment
                </button>
            </div>
            {% endif %}

        </div>
    </div>
</div>

{% include "create_comment_modal.html" %}

<script>
    document.addEventListener("DOMContentLoaded", function () {
        if (typeof feather !== 'undefined') {
            feather.replace();
        }
    });
</script>

{% endblock %}